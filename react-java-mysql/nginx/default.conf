# 1. Definición de los servidores aguas arriba (upstream)
# Usamos los nombres de los servicios definidos en el docker-compose
upstream frontend_server {
    server frontend:80; # Puerto interno donde corre React
}

upstream backend_api {
    server backend:8080; # Puerto interno donde corre el Java App Server
}

server {
    listen 80;
    server_name localhost;

    # 2. Configuración para el Frontend
    # Todas las peticiones a la raíz (/) se redirigen al servicio frontend
    location / {
        proxy_pass http://frontend_server;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 3. Configuración para el Backend (API)
    # Las peticiones que empiecen por /api se redirigen al servicio Java
    location /api {
        proxy_pass http://backend_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}